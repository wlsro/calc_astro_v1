---
import Layout from "../../../layouts/Layout.astro";
import Header from "../../../components/Header.astro";
import Footer from "../../../components/Footer.astro";
import catalogData from "../../../data/catalog.json";

export async function getStaticPaths() {
    const paths = Object.values(catalogData).map((model) => ({
        params: { model_name: model.model_name },
        props: { model },
    }));
    return paths;
}

const { model } = Astro.props;
---

<Layout title={`Багет серії ${model.model_name} - Art Millennium`}>
    <Header />

    <main class="bg-main-bg min-h-screen py-12">
        <div class="container mx-auto px-4">
            <!-- Breadcrumbs (Optional but good for UX) -->
            <nav class="text-sm mb-8 text-secondary-text">
                <a href="/" class="hover:text-accent">Головна</a>
                <span class="mx-2">/</span>
                <a href="/catalog/molding" class="hover:text-accent">Каталог</a>
                <span class="mx-2">/</span>
                <span class="text-main-text font-semibold"
                    >{model.model_name}</span
                >
            </nav>

            <!-- Model Info Section -->
            <section
                class="bg-cards rounded-2xl shadow-sm border border-main-borders p-8 mb-12"
            >
                <div class="flex flex-col md:flex-row gap-8 items-start">
                    <div class="w-full md:w-1/3 lg:w-1/4">
                        <div
                            class="aspect-[4/3] rounded-xl overflow-hidden bg-gray-100 border border-main-borders relative group"
                        >
                            <img
                                src={model.group_image}
                                alt={`Серія ${model.model_name}`}
                                class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
                            />
                        </div>
                    </div>

                    <div class="w-full md:w-2/3 lg:w-3/4">
                        <h1
                            class="text-3xl md:text-4xl font-bold text-main-text mb-2"
                        >
                            Серія {model.model_name}
                        </h1>

                        <div class="flex flex-wrap gap-2 mb-6">
                            {
                                model.category.map((cat) => (
                                    <span class="px-3 py-1 bg-main-bg border border-main-borders text-secondary-text text-sm rounded-full">
                                        {cat}
                                    </span>
                                ))
                            }
                        </div>

                        <div
                            class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8 text-secondary-text"
                        >
                            <div>
                                <span class="block text-sm opacity-70"
                                    >Ціна</span
                                >
                                <span class="text-2xl font-bold text-accent"
                                    >{model.price} грн/м</span
                                >
                            </div>
                            <div>
                                <span class="block text-sm opacity-70"
                                    >Ширина</span
                                >
                                <span
                                    class="text-xl font-semibold text-main-text"
                                    >{model.width} мм</span
                                >
                            </div>
                            <div>
                                <span class="block text-sm opacity-70"
                                    >Висота</span
                                >
                                <span
                                    class="text-xl font-semibold text-main-text"
                                    >{model.height} мм</span
                                >
                            </div>
                        </div>

                        <p
                            class="text-secondary-text leading-relaxed max-w-2xl"
                        >
                            Високоякісний пластиковий багет серії <b
                                >{model.model_name}</b
                            > ідеально підходить для оформлення як сучасних, так і
                            класичних інтер'єрів. Стійкий до вологи та механічних
                            пошкоджень.
                        </p>
                    </div>
                </div>
            </section>

            <!-- Variants Grid -->
            <section>
                <h2
                    class="text-2xl font-bold text-main-text mb-8 border-b border-main-borders pb-4"
                >
                    Кольори серії ({model.variants.length})
                </h2>

                <div
                    class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6"
                >
                    {
                        model.variants.map((variant) => (
                            <div
                                class="variant-card cursor-pointer group"
                                data-full-img={variant.main_img}
                                data-title={variant.id}
                            >
                                <div class="aspect-square bg-cards rounded-xl overflow-hidden shadow-sm border border-main-borders mb-3 relative">
                                    <img
                                        src={variant.thumb}
                                        alt={variant.id}
                                        class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"
                                        loading="lazy"
                                    />
                                    <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100">
                                        <span class="bg-white/90 text-main-text p-2 rounded-full shadow-lg">
                                            <svg
                                                class="w-6 h-6"
                                                fill="none"
                                                stroke="currentColor"
                                                viewBox="0 0 24 24"
                                            >
                                                <path
                                                    stroke-linecap="round"
                                                    stroke-linejoin="round"
                                                    stroke-width="2"
                                                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"
                                                />
                                            </svg>
                                        </span>
                                    </div>
                                </div>
                                <h3 class="text-center font-semibold text-main-text group-hover:text-accent transition-colors">
                                    {variant.id}
                                </h3>
                            </div>
                        ))
                    }
                </div>
            </section>
        </div>
    </main>

    <Footer />

    <!-- Lightbox Modal -->
    <div
        id="lightbox"
        class="fixed inset-0 z-[100] bg-black/90 hidden flex items-center justify-center opacity-0 transition-opacity duration-300"
    >
        <!-- Close Button -->
        <button
            id="lightboxClose"
            class="absolute top-4 right-4 text-white hover:text-accent transition-colors p-2 z-50 focus:outline-none"
        >
            <svg
                class="w-10 h-10"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                ><path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18L18 6M6 6l12 12"></path></svg
            >
        </button>

        <!-- Image Container -->
        <div
            class="relative max-w-5xl max-h-[90vh] w-full p-4 flex flex-col items-center justify-center"
            id="lightboxContent"
        >
            <img
                id="lightboxImg"
                src=""
                alt=""
                class="max-w-full max-h-[85vh] object-contain rounded-lg shadow-2xl"
            />
            <p
                id="lightboxCaption"
                class="text-white text-xl font-semibold mt-4"
            >
            </p>
        </div>
    </div>
</Layout>

<script>
    const variants = document.querySelectorAll(".variant-card");
    const lightbox = document.getElementById("lightbox");
    const lightboxImg = document.getElementById(
        "lightboxImg",
    ) as HTMLImageElement;
    const lightboxCaption = document.getElementById("lightboxCaption");
    const closeBtn = document.getElementById("lightboxClose");
    const lightboxContent = document.getElementById("lightboxContent");

    function openLightbox(imgSrc: string, title: string) {
        if (!lightbox || !lightboxImg || !lightboxCaption) return;

        lightboxImg.src = imgSrc;
        lightboxCaption.textContent = title;

        lightbox.classList.remove("hidden");
        // Small delay to allow display:block to apply before opacity transition
        setTimeout(() => {
            lightbox.classList.remove("opacity-0");
        }, 10);

        document.body.style.overflow = "hidden"; // Prevent background scrolling
    }

    function closeLightbox() {
        if (!lightbox) return;

        lightbox.classList.add("opacity-0");
        setTimeout(() => {
            lightbox.classList.add("hidden");
            if (lightboxImg) lightboxImg.src = "";
        }, 300); // Wait for transition

        document.body.style.overflow = "";
    }

    // Attach click events to variants
    variants.forEach((card) => {
        card.addEventListener("click", () => {
            const img = (card as HTMLElement).dataset.fullImg;
            const title = (card as HTMLElement).dataset.title;
            if (img && title) openLightbox(img, title);
        });
    });

    // Close on button click
    closeBtn?.addEventListener("click", (e) => {
        e.stopPropagation();
        closeLightbox();
    });

    // Close on click outside (background)
    lightbox?.addEventListener("click", (e) => {
        if (e.target === lightbox || e.target === lightboxContent) {
            closeLightbox();
        }
    });

    // Close on Escape key
    document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && !lightbox?.classList.contains("hidden")) {
            closeLightbox();
        }
    });
</script>
